/** * Created with IntelliJ IDEA. * User: cth * Date: 15-5-26 * Time: 上午9:57 * To change this template use File | Settings | File Templates. */var SignAjax = {    request : function(url, data,suc) {        var req={            url:url,            method:"GET",            cal:data.cal        };        APIUtils.request(req).then(function(d){            suc(d);        });    }};var React = require('react/addons');var $ = require('jquery');require("jquery-ui");var components = require('../../vendors/components');var Header = components.Header;var APIUtils = require('../../utils/api-utils');var MPToolBar=React.createClass({    getInitialState:function(){        return {            user:""        }    },    doClick:function(e){        var v=this.state.user;        this.props.handleClick(v);    },    doExcel:function(){        this.props.handlerExcel();    },    _onChange: function(e) {        var v=e.target.value;        this.setState({ user: v });    },    render:function(){        $('#startTime').datepicker({dateFormat:'yy-mm-dd'});        $('#endTime').datepicker({dateFormat:'yy-mm-dd'});        return (<div>员工登录名:<input type='text' onChange={this._onChange} />开始时间:<input type='text' id='startTime' name='startTime' />结束时间:<input type='text' id='endTime' name='endTime' /><button className="btn btn-outlined btn-warning btn-sm" onClick={this.doClick} disabled="true">查找</button ><button  className="btn btn-outlined btn-warning btn-sm" onClick={this.doExcel}>导出Excel</button></div>);}});var PageBar=React.createClass({    getInitialState:function(){        return {            offer:1,            nextEnabled:"",            previousEnabled:""        };    },    previous:function(offer){        var offer=this.state.offer;        var i=offer-1;        if(i<0){            i=1;        }        this.setState({            offer:i        });        this.props.previous(i);    },    next:function(offer){        var offer=this.state.offer;        var total=this.props.totalRows;        var i=offer+1;        if(i>total){            i=total;        }        this.setState({            offer:i        });        this.props.next(i);    },    render:function(){        var totalRows=this.props.totalRows;        var pageSize=this.props.pageSize;        var page=this.props.page;        var offer=page;        this.state.offer=page;        var t=<div></div>;        var page=Math.ceil(totalRows/pageSize);        var pmsg="[共"+page+"页当前是第"+offer+"页]";        if(totalRows>0&&page>1){            if(offer==1){                t=<div className="page_button"><b>{pmsg}</b><button className="btn btn-outlined btn-warning btn-sm" onClick={this.next} disabled={this.state.nextEnabled}>下一页</button></div>;            }else if(offer==page){                t=<div className="page_button"><b>{pmsg}</b><button className="btn btn-outlined btn-warning btn-sm" onClick={this.previous} disabled={this.state.previousEnabled}>上一页</button></div>;            }else{                t=<div className="page_button"><b>{pmsg}</b><button className="btn btn-outlined btn-warning btn-sm" onClick={this.previous} disabled={this.state.previousEnabled}>上一页</button><button className="btn btn-outlined btn-warning btn-sm" onClick={this.next} disabled={this.state.nextEnabled}>下一页</button></div>;    }}return (t);}});var SignTable=React.createClass({    render:function(){        var data=this.props.data;        var rows=[];        data.forEach(function(d){            var t=<tr><td>{d.user}</td><td>{d.department}</td><td>{d.signTime}</td><td>{d.address}</td></tr>;            rows.push(t);});var t= <table  className="table table-hover table-bordered">        <thead>        <tr>        <th>员工</th>        <th>部门</th>        <th>签到时间</th>        <th>签到地点</th>        </tr>        </thead>        <tbody>        {rows}        </tbody>        </table>;        return t;}});var SignList = React.createClass({    getInitialState:function(){        return {            totalRows:0,            pageSize:10,            data:[],            offset:1,            user:"",            startTime:"",            endTime:""        };    },componentDidMount:function(){    var path=getPath();    var param="?user="+this.state.user+"&startTime="+this.state.startTime+"&endTime="+this.state.endTime+"&offset="+this.state.offset+"&pageSize="+this.state.pageSize;    this.state.cal=this.buttonTest;    SignAjax.request(path+"/api/mp/list"+param,this.state,this._success);},_success:function(res){    if(res){        this.setState({            data:res.data.data,            totalRows:res.data.total        });    }},_doList:function(data){    var path=getPath();    var param="?user="+this.state.user+"&startTime="+this.state.startTime+"&endTime="+this.state.endTime+"&offset="+this.state.offset+"&pageSize="+this.state.pageSize;    SignAjax.request(path+"/api/mp/list"+param,this.state,this._success);},clickHandle:function(v){    var d=this.state;    var startTime=$('#startTime').val();    var endTime=$('#endTime').val();    d.user=v;    d.offset=1;    this.state.startTime=startTime;    this.state.endTime=endTime;    this._doList(this.state);},doPrevious:function(d){    var startTime=$('#startTime').val();    var endTime=$('#endTime').val();    this.state.startTime=startTime;    this.state.endTime=endTime;    this.state.offset=d;    this._doList(this.state);},doNext:function(d){    var startTime=$('#startTime').val();    var endTime=$('#endTime').val();    this.state.startTime=startTime;    this.state.endTime=endTime;    this.state.offset=d;    this._doList(this.state);},clickExportExcel:function(){    var startTime=$('#startTime').val();    var endTime=$('#endTime').val();    var user=this.state.user;    var path=getPath();    location.href=path+"/api/mp/exportExcel?user="+user+"&startTime="+startTime+"&endTime="+endTime;},buttonTest:function(flag){    return true;},render: function() {    return (        <div >          <Header pageTitle="签到查询管理" />            <div className="page-content">                <div  className="portlet portlet-white">                    <div className="portlet-body">                        <MPToolBar  handleClick={this.clickHandle} handlerExcel={this.clickExportExcel} />                        <PageBar  previous={this.doPrevious} next={this.doNext} pageSize={this.state.pageSize} page={this.state.offset} totalRows={this.state.totalRows}/>                        <SignTable data={this.state.data}/>                     </div>                </div>            </div>       </div>      );    }});module.exports = SignList;